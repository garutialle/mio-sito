<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Toolbox ‚Äì Password, IP & Subnet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #ffffff;
      --fg: #000000;
      --primary: #007acc;
      --accent: #00c853;
      --input-bg: #f0f0f0;
      --border: #ccc;
    }
    [data-theme="dark"] {
      --bg: #1e1e1e;
      --fg: #f0f0f0;
      --primary: #007acc;
      --accent: #00c853;
      --input-bg: #333;
      --border: #555;
    }
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: var(--bg);
      color: var(--fg);
      transition: background 0.3s, color 0.3s;
    }
    header, footer {
      text-align: center;
      padding: 1rem;
      background: var(--input-bg);
      border-bottom: 1px solid var(--border);
    }
    nav {
      text-align: center;
      padding: 1rem;
    }
    nav button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 1rem;
      background: var(--primary);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
    }
    nav button.active {
      background: var(--accent);
    }
    main {
      padding: 2rem;
      text-align: center;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    input[type="range"], input[type="text"] {
      width: 80%;
      font-size: 1rem;
      padding: 0.5rem;
      margin-top: 1rem;
      background: var(--input-bg);
      border: 2px solid var(--border);
      color: var(--fg);
      border-radius: 4px;
      text-align: center;
    }
    input[type="checkbox"] {
      margin-right: 0.5rem;
    }
    #copiato {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--accent);
      opacity: 0;
      transition: opacity 0.4s ease-in-out;
    }
    #copiato.visibile {
      opacity: 1;
    }
    .theme-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--fg);
    }
  </style>
</head>
<body data-theme="light">
  <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
  <header><h1>Toolbox ‚Äì Password, IP & Subnet</h1></header>
  <nav>
    <button data-section="password" class="active">üîê Password</button>
    <button data-section="ip">üåç IP</button>
    <button data-section="subnet">üìê Subnet</button>
  </nav>
  <main>
    <section id="password" class="active">
      <h2>Generatore Password</h2>
      <label for="length">Lunghezza: <span id="valoreLunghezza">12</span></label><br>
      <input type="range" id="length" min="6" max="64" value="12" />
      <div>
        <label><input type="checkbox" id="uppercase" checked> Lettere maiuscole</label><br>
        <label><input type="checkbox" id="numbers" checked> Numeri</label><br>
        <label><input type="checkbox" id="symbols"> Simboli</label><br>
        <label><input type="checkbox" id="noRepeat"> Evita caratteri ripetuti</label>
      </div>
      <input type="text" id="output" readonly>
      <p id="copiato">‚úÖ Copiata negli appunti!</p>
    </section>
    <section id="ip">
      <h2>Il tuo IP pubblico</h2>
      <p>Il tuo indirizzo IP √®:</p>
      <h3 id="ipVal">Caricamento...</h3>
    </section>
    <section id="subnet">
      <h2>Calcolatore Subnet/CIDR</h2>
      <p>Inserisci un indirizzo IP e CIDR (es: <code>192.168.1.10/24</code>)</p>
      <input type="text" id="subnetInput" placeholder="192.168.1.10/24"><br>
      <button onclick="calcolaSubnet()">Calcola</button>
      <div id="subnetOutput" style="margin-top: 1rem; text-align: left; max-width: 400px; margin-inline: auto;"></div>
    </section>
  </main>
  <footer><p>¬© 2025 Alessandro Garuti</p></footer>
  <script>
    document.querySelectorAll("nav button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
        document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.section).classList.add("active");
      });
    });
    function toggleTheme() {
      const body = document.body;
      body.setAttribute("data-theme", body.getAttribute("data-theme") === "dark" ? "light" : "dark");
    }
    function generaPassword(lunghezza, opzioni) {
      const lettere = "abcdefghijklmnopqrstuvwxyz";
      const lettereMaiuscole = lettere.toUpperCase();
      const numeri = "0123456789";
      const simboli = "!@#$%^&*()_+[]{}<>?/";
      let caratteri = lettere;
      if (opzioni.uppercase) caratteri += lettereMaiuscole;
      if (opzioni.numbers) caratteri += numeri;
      if (opzioni.symbols) caratteri += simboli;
      if (!caratteri) return "";
      if (opzioni.noRepeat) {
        const caratteriUnici = [...new Set(caratteri)];
        if (caratteriUnici.length < lunghezza) return `‚ö†Ô∏è Max ${caratteriUnici.length} caratteri unici!`;
        for (let i = caratteriUnici.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [caratteriUnici[i], caratteriUnici[j]] = [caratteriUnici[j], caratteriUnici[i]];
        }
        return caratteriUnici.slice(0, lunghezza).join('');
      } else {
        let password = "";
        for (let i = 0; i < lunghezza; i++) {
          const randIndex = Math.floor(Math.random() * caratteri.length);
          password += caratteri[randIndex];
        }
        return password;
      }
    }
    function aggiornaPassword() {
      const l = parseInt(document.getElementById("length").value);
      const o = {
        uppercase: document.getElementById("uppercase").checked,
        numbers: document.getElementById("numbers").checked,
        symbols: document.getElementById("symbols").checked,
        noRepeat: document.getElementById("noRepeat").checked,
      };
      const password = generaPassword(l, o);
      const output = document.getElementById("output");
      output.value = password;
      output.select();
      document.execCommand("copy");
      const msg = document.getElementById("copiato");
      msg.classList.add("visibile");
      setTimeout(() => msg.classList.remove("visibile"), 2000);
    }
    ["length", "uppercase", "numbers", "symbols", "noRepeat"].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener("input", aggiornaPassword);
      el.addEventListener("change", aggiornaPassword);
    });
    document.getElementById("length").addEventListener("input", e => {
      document.getElementById("valoreLunghezza").textContent = e.target.value;
    });
    aggiornaPassword();
    fetch('https://api.ipify.org?format=json')
      .then(res => res.json())
      .then(data => document.getElementById("ipVal").textContent = data.ip)
      .catch(() => document.getElementById("ipVal").textContent = "Errore nel recupero IP.");
    function calcolaSubnet() {
      const input = document.getElementById("subnetInput").value.trim();
      const output = document.getElementById("subnetOutput");
      const match = input.match(/^\s*(\d{1,3}(?:\.\d{1,3}){3})\/(\d{1,2})\s*$/);
      if (!match) {
        output.innerHTML = `<p style="color: red;">‚ö†Ô∏è Inserire IP/CIDR valido (es. 192.168.1.1/24)</p>`;
        return;
      }
      const ip = match[1].split(".").map(Number);
      const cidr = parseInt(match[2]);
      if (ip.some(o => o < 0 || o > 255) || cidr < 0 || cidr > 32) {
        output.innerHTML = `<p style="color: red;">‚ö†Ô∏è IP o CIDR non valido</p>`;
        return;
      }
      const ipNum = (ip[0] << 24) | (ip[1] << 16) | (ip[2] << 8) | ip[3];
      const mask = cidr === 0 ? 0 : 0xffffffff << (32 - cidr);
      const net = ipNum & mask;
      const bcast = net | (~mask >>> 0);
      const totalHost = cidr < 31 ? (2 ** (32 - cidr) - 2) : (2 ** (32 - cidr));
      function toIP(n) {
        return [(n >>> 24), (n >>> 16) & 255, (n >>> 8) & 255, n & 255].join(".");
      }
      output.innerHTML = `
        <p><strong>IP:</strong> ${toIP(ipNum)}</p>
        <p><strong>Netmask:</strong> ${toIP(mask)} (${cidr})</p>
        <p><strong>Rete:</strong> ${toIP(net)}</p>
        <p><strong>Broadcast:</strong> ${toIP(bcast)}</p>
        <p><strong>Host disponibili:</strong> ${totalHost}</p>
        ${cidr < 31 ? `<p><strong>Range host:</strong> ${toIP(net + 1)} - ${toIP(bcast - 1)}</p>` : ''}
      `;
    }
  </script>
</body>
</html>
